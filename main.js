/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var g=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var S=(n,e)=>{for(var t in e)g(n,t,{get:e[t],enumerable:!0})},C=(n,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of y(e))!L.call(n,l)&&l!==t&&g(n,l,{get:()=>e[l],enumerable:!(o=T(e,l))||o.enumerable});return n};var v=n=>C(g({},"__esModule",{value:!0}),n);var x={};S(x,{default:()=>u});module.exports=v(x);var c=require("obsidian");var r=require("obsidian"),E={foldThreshold:5},d=class extends r.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new r.Setting(e).setName("Fold threshold").setDesc("Number of lines after which code blocks will be folded").addSlider(t=>t.setLimits(3,20,1).setValue(this.plugin.settings.foldThreshold).setDynamicTooltip().onChange(async o=>{this.plugin.settings.foldThreshold=o,await this.plugin.saveSettings(),this.plugin.refreshAllCodeBlocks()}))}};var u=class extends c.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new d(this.app,this)),this.registerMarkdownPostProcessor(e=>{e.querySelectorAll("pre").forEach(o=>{this.processCodeBlock(o)})})}processCodeBlock(e){var k;let t=e.querySelector("code");if(!t||e.querySelector(".code-block-fold-header"))return;let o=(((k=t.textContent)==null?void 0:k.split(`
`))||[]).length,{foldThreshold:l}=this.settings,s=e.createDiv({cls:"code-block-fold-header"}),a=this.extractLanguage(t),i=s.createSpan({cls:"code-block-language"});i.setText(this.capitalizeLanguage(a)||"Code");let f=s.createDiv({cls:"code-block-fold-buttons"}),h=null,p=null;if(o>l){let m=this.createFoldButton(f,e,o,l);h=m.foldBtn,p=m.foldInfoEl,this.registerDomEvent(s,"click",b=>{(b.target===s||b.target===i)&&this.toggleFold(e,h,p)})}this.createCopyButton(f,t),e.insertBefore(s,e.firstChild)}createFoldButton(e,t,o,l){let s=e.createEl("button",{cls:"code-block-fold-btn",attr:{"aria-label":"Toggle fold","aria-expanded":"false","data-tooltip-position":"top"}});s.setText("\u25BC"),t.classList.add("code-block-folded"),t.dataset.foldThreshold=String(l+1);let a=t.createDiv({cls:"code-block-fold-info"});return a.setText(`\u8FD8\u6709 ${o-l-1} \u884C\u4EE3\u7801\u88AB\u6298\u53E0`),this.registerDomEvent(s,"click",i=>{i.stopPropagation(),this.toggleFold(t,s,a)}),s.addEventListener("keydown",i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),s.click())}),{foldBtn:s,foldInfoEl:a}}createCopyButton(e,t){let o=e.createEl("button",{cls:"code-block-copy-btn",attr:{"aria-label":"Copy code","data-tooltip-position":"top"}});o.setText("\u{1F4CB}"),this.registerDomEvent(o,"click",async l=>{l.stopPropagation();let s=t.textContent||"";try{await navigator.clipboard.writeText(s),new c.Notice("Copied to clipboard")}catch(a){new c.Notice("Failed to copy")}}),o.addEventListener("keydown",l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),o.click())})}extractLanguage(e){let t=e.className.split(" ");for(let o of t)if(o.startsWith("language-"))return o.replace("language-","");return null}capitalizeLanguage(e){return e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():null}toggleFold(e,t,o){let l=e.classList.contains("code-block-folded");l?(e.classList.remove("code-block-folded"),t.setText("\u25B2"),t.setAttribute("aria-label","Collapse"),t.setAttribute("aria-expanded","true")):(e.classList.add("code-block-folded"),t.setText("\u25BC"),t.setAttribute("aria-label","Expand"),t.setAttribute("aria-expanded","false")),o.classList.toggle("is-hidden",!l)}async loadSettings(){let e=await this.loadData();this.settings=Object.assign({},E,e)}async saveSettings(){await this.saveData(this.settings)}refreshAllCodeBlocks(){document.querySelectorAll("pre:has(.code-block-fold-header)").forEach(e=>{var t,o;(t=e.querySelector(".code-block-fold-header"))==null||t.remove(),(o=e.querySelector(".code-block-fold-info"))==null||o.remove(),e.classList.remove("code-block-folded"),delete e.dataset.foldThreshold}),document.querySelectorAll("pre").forEach(e=>{e.querySelector("code")&&!e.querySelector(".code-block-fold-header")&&this.processCodeBlock(e)})}};
