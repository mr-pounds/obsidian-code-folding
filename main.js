/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var p=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var B=(c,e)=>{for(var t in e)p(c,t,{get:e[t],enumerable:!0})},w=(c,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of F(e))!x.call(c,s)&&s!==t&&p(c,s,{get:()=>e[s],enumerable:!(o=v(e,s))||o.enumerable});return c};var D=c=>w(p({},"__esModule",{value:!0}),c);var A={};B(A,{default:()=>u});module.exports=D(A);var r=require("obsidian");var f=require("obsidian"),E={foldThreshold:5},h=class extends f.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new f.Setting(e).setName("Fold threshold").setDesc("Number of lines after which code blocks will be folded").addSlider(t=>t.setLimits(3,20,1).setValue(this.plugin.settings.foldThreshold).setDynamicTooltip().onChange(async o=>{this.plugin.settings.foldThreshold=o,await this.plugin.saveSettings(),this.plugin.refreshAllCodeBlocks()}))}};var u=class extends r.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new h(this.app,this)),this.registerMarkdownPostProcessor(e=>{e.querySelectorAll("pre").forEach(o=>{this.processCodeBlock(o)})})}processCodeBlock(e){var y;let t=e.querySelector("code");if(!t)return;let s=(((y=t.textContent)==null?void 0:y.split(`
`))||[]).length,d=this.settings.foldThreshold;if(e.querySelector(".code-block-fold-header"))return;let a=e.createDiv({cls:"code-block-fold-header"}),S=this.extractLanguage(t),b=a.createSpan({cls:"code-block-language"});b.setText(this.capitalizeLanguage(S)||"Code");let m=a.createDiv({cls:"code-block-fold-buttons"}),i=null;if(s>d){i=m.createEl("button",{cls:"code-block-fold-btn",attr:{"aria-label":"Toggle fold","data-tooltip-position":"top"}}),i.setText("\u25BC"),e.classList.add("code-block-folded"),e.style.setProperty("--fold-threshold",String(d+1));let n=e.createDiv({cls:"code-block-fold-info"}),k=s-d-1;n.setText(`\u8FD8\u6709 ${k} \u884C\u4EE3\u7801\u88AB\u6298\u53E0`);let T=()=>{let l=e.classList.contains("code-block-folded");n.style.display=l?"block":"none"},C=this.toggleFold.bind(this);this.toggleFold=(l,L)=>{C(l,L),T()},this.registerDomEvent(i,"click",l=>{l.stopPropagation(),this.toggleFold(e,i)}),i.addEventListener("keydown",l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),i.click())}),this.registerDomEvent(a,"click",l=>{(l.target===a||l.target===b)&&this.toggleFold(e,i)})}let g=m.createEl("button",{cls:"code-block-copy-btn",attr:{"aria-label":"Copy code","data-tooltip-position":"top"}});g.setText("\u{1F4CB}"),this.registerDomEvent(g,"click",async n=>{n.stopPropagation();let k=t.textContent||"";try{await navigator.clipboard.writeText(k),new r.Notice("Copied to clipboard")}catch(T){new r.Notice("Failed to copy")}}),g.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),g.click())}),e.insertBefore(a,e.firstChild)}extractLanguage(e){let t=e.className.split(" ");for(let o of t)if(o.startsWith("language-"))return o.replace("language-","");return null}capitalizeLanguage(e){return e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():null}toggleFold(e,t){e.classList.contains("code-block-folded")?(e.classList.remove("code-block-folded"),t.setText("\u25B2"),t.setAttribute("aria-label","Collapse")):(e.classList.add("code-block-folded"),t.setText("\u25BC"),t.setAttribute("aria-label","Expand"))}async loadSettings(){let e=await this.loadData();this.settings=Object.assign({},E,e)}async saveSettings(){await this.saveData(this.settings)}refreshAllCodeBlocks(){document.querySelectorAll("pre:has(.code-block-fold-header)").forEach(o=>{let s=o.querySelector(".code-block-fold-header");s&&s.remove();let d=o.querySelector(".code-block-fold-info");d&&d.remove(),o.classList.remove("code-block-folded"),o.style.removeProperty("--fold-threshold")}),document.querySelectorAll("pre").forEach(o=>{o.querySelector("code")&&!o.querySelector(".code-block-fold-header")&&this.processCodeBlock(o)})}};
